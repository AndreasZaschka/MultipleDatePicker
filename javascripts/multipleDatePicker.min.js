angular.module("multipleDatePicker",[]).factory("multipleDatePickerBroadcast",["$rootScope",function(e){var t={};return t.calendarId=null,t.message="",t.resetOrder=function(e){this.message="reset",this.calendarId=e,this.broadcastItem()},t.broadcastItem=function(){e.$broadcast("handleMultipleDatePickerBroadcast")},t}]).directive("multipleDatePicker",["$log","multipleDatePickerBroadcast",function(e,t){"use strict";return{restrict:"AE",scope:{calendarId:"=?",ngModel:"=?",highlightDays:"=?",dayClick:"=?",dayHover:"=?",month:"=?",monthChanged:"=?",weekDaysOff:"=?",allDaysOff:"=?",sundayFirstDay:"=?",disallowBackPastMonths:"=?",disallowGoFuturMonths:"=?",showDaysOfSurroundingMonths:"=?",cssDaysOfSurroundingMonths:"=?",fireEventsForDaysOfSurroundingMonths:"=?",disableDaysBefore:"=?",disableDaysAfter:"=?"},template:'<div class="multiple-date-picker"><div class="picker-top-row"><div class="text-center picker-navigate picker-navigate-left-arrow" ng-class="{\'disabled\':disableBackButton}" ng-click="previousMonth()">&lt;</div><div class="text-center picker-month">{{month.format(\'MMMM YYYY\')}}</div><div class="text-center picker-navigate picker-navigate-right-arrow" ng-class="{\'disabled\':disableNextButton}" ng-click="nextMonth()">&gt;</div></div><div class="picker-days-week-row"><div class="text-center" ng-repeat="day in daysOfWeek">{{day}}</div></div><div class="picker-days-row">'+"<div class=\"text-center picker-day {{!day.mdp.otherMonth || showDaysOfSurroundingMonths ? day.css : ''}} {{day.mdp.otherMonth ? cssDaysOfSurroundingMonths : ''}}\" title=\"{{day.title}}\" ng-repeat=\"day in days\" ng-click=\"toggleDay($event, day)\" ng-mouseover=\"hoverDay($event, day)\" ng-mouseleave=\"dayHover($event, day)\" ng-class=\"{'picker-selected':day.mdp.selected, 'picker-off':!day.selectable, 'today':day.mdp.today,'past':day.mdp.past,'future':day.mdp.future, 'picker-other-month':day.mdp.otherMonth}\">{{day ? day.mdp.otherMonth && !showDaysOfSurroundingMonths ? '&nbsp;' : day.date.format('D') : ''}}</div></div></div>",link:function(e){e.ngModel=e.ngModel||[];var a=function(){var t=moment(),a=moment(e.month).subtract(1,"month"),n=moment(e.month).add(1,"month");e.disableBackButton=e.disallowBackPastMonths&&t.isAfter(a,"month"),e.disableNextButton=e.disallowGoFuturMonths&&t.isBefore(n,"month")},n=function(){for(var t=moment().localeData()._weekdaysMin,a=[],n=1;7>n;n++)a.push(t[n]);return e.sundayFirstDay?a.splice(0,0,t[0]):a.push(t[0]),a},d=function(){var t=e.daysSelected||[],a=[];t.map(function(e){a.push(moment(e))}),e.convertedDaysSelected=a,e.generate()};e.$on("handleMultipleDatePickerBroadcast",function(){"reset"!==t.message||t.calendarId&&t.calendarId!==e.calendarId||d()}),e.$watch("ngModel",function(){e.generate()},!0),e.$watch("highlightDays",function(){e.generate()},!0),e.$watch("weekDaysOff",function(){e.generate()},!0),e.$watch("allDaysOff",function(){e.generate()},!0),e.month=e.month||moment().startOf("day"),e.days=[],e.weekDaysOff=e.weekDaysOff||[],e.daysOff=e.daysOff||[],e.disableBackButton=!1,e.disableNextButton=!1,e.daysOfWeek=n(),e.cssDaysOfSurroundingMonths=e.cssDaysOfSurroundingMonths||"picker-empty",e.toggleDay=function(t,a){if(t.preventDefault(),!a.mdp.otherMonth||e.fireEventsForDaysOfSurroundingMonths){var n=!1;t.preventDefault=function(){n=!0},"function"==typeof e.dayClick&&e.dayClick(t,a),a.selectable&&!n&&(a.mdp.selected=!a.mdp.selected,a.mdp.selected?e.ngModel.push(a.date):e.ngModel=e.ngModel.filter(function(e){return!a.date.isSame(e,"day")}))}},e.hoverDay=function(t,a){t.preventDefault();var n=!1;t.preventDefault=function(){n=!0},"function"==typeof e.dayHover&&e.dayHover(t,a),n||(a.mdp.hover="mouseover"===t.type)},e.previousMonth=function(){if(!e.disableBackButton){var t=moment(e.month);e.month=e.month.subtract(1,"month"),"function"==typeof e.monthChanged&&e.monthChanged(e.month,t),e.generate()}},e.nextMonth=function(){if(!e.disableNextButton){var t=moment(e.month);e.month=e.month.add(1,"month"),"function"==typeof e.monthChanged&&e.monthChanged(e.month,t),e.generate()}},e.isDayOff=function(t){return e.allDaysOff||!!e.disableDaysBefore&&moment(t.date).isBefore(e.disableDaysBefore,"day")||!!e.disableDaysAfter&&moment(t.date).isAfter(e.disableDaysAfter,"day")||angular.isArray(e.weekDaysOff)&&e.weekDaysOff.some(function(e){return t.date.day()===e})||angular.isArray(e.daysOff)&&e.daysOff.some(function(e){return t.date.isSame(e,"day")})||angular.isArray(e.highlightDays)&&e.highlightDays.some(function(e){return t.date.isSame(e.date,"day")&&!e.selectable})},e.isSelected=function(t){return e.ngModel.some(function(e){return t.date.isSame(e,"day")})},e.generate=function(){var t=moment(e.month).date(0).day(e.sundayFirstDay?0:1).subtract(1,"day");moment(e.month).date(0).diff(t,"day")>6&&(t=t.add(1,"week"));var n=moment(e.month).date(1),d=[],s=moment(),o=moment(n).endOf("month"),r=function(){var a={date:moment(t.add(1,"day")),mdp:{selected:!1}};if(angular.isArray(e.highlightDays)){var n=e.highlightDays.filter(function(e){return a.date.isSame(e.date,"day")});a.css=n.length>0?n[0].css:"",a.title=n.length>0?n[0].title:""}return a.selectable=!e.isDayOff(a),a.mdp.selected=e.isSelected(a),a.mdp.today=a.date.isSame(s,"day"),a.mdp.past=a.date.isBefore(s,"day"),a.mdp.future=a.date.isAfter(s,"day"),a.date.isSame(e.month,"month")||(a.mdp.otherMonth=!0),a},i=o.diff(t,"days"),c=e.sundayFirstDay?6:0;o.day()!==c&&(i+=(e.sundayFirstDay?6:7)-o.day());for(var l=0;i>l;l++)d.push(r());e.days=d,a()},e.generate()}}}]);